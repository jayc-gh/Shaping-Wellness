name: Keep donation endpoints warm

on: 
  schedule:
    - cron: '*/10 * * * *' # every 10 min
  push:
    branches:
      - main
      - dev

jobs:
  warmup:
    runs-on: ubuntu-latest
    steps:
      - name: Ping endpoints
        run: |
          # Determine base URL based on branch
          if [ "${GITHUB_REF##*/}" = "main" ]; then
            BASE_URL="https://shapingwellness.org"
          else
            BASE_URL="https://shaping-wellness.vercel.app"
          fi

          # List of endpoints to keep warm
          ENDPOINTS=(
            "/api/create-payment-intent?warmup=1"
            "/api/create-subscription?warmup=1"
          )

          # Ping each endpoint
          for EP in "${ENDPOINTS[@]}"; do
            echo "Pinging $BASE_URL$EP"
            curl -s "$BASE_URL$EP" || echo "Ping failed for $EP"
          done
